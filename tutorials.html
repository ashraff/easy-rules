<!DOCTYPE html>
<html lang="en">
<head>
    <title>Easy Rules</title>
    <meta charset="utf-8">
    <meta name="description" content="Easy Rules is a simple yet powerful Java Rules Engine">
    <meta name="author" content="Mahmoud Ben Hassine">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="img/gear.ico"/>
    <link href="css/bootstrap.min.css" rel="stylesheet" media="screen">
    <link href="css/offcanvas.css" rel="stylesheet" media="screen">
    <link href="css/font-awesome.min.css" rel="stylesheet">
    <link href="css/idea.css" rel="stylesheet">

    <script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-46301888-1']);
        _gaq.push(['_trackPageview']);

        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();

    </script>

</head>
<body>

<div class="navbar navbar-fixed-top navbar-inverse" role="navigation">

    <div class="container">

        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="index.html"><i class="fa fa-gears"></i> Easy Rules</a>
        </div>
        <div class="collapse navbar-collapse">
            <p class="navbar-text pull-right">Version: 1.0.1</p>
            <ul class="nav navbar-nav">
                <li><a href="index.html"><i class="fa fa-home"></i> Home</a></li>
                <li><a href="gettingStarted.html"><i class="fa fa-folder-open"></i> Getting started</a></li>
                <li><a href="documentation.html"><i class="fa fa-book"></i> Documentation</a></li>
                <li class="active"><a href="tutorials.html"><i class="fa fa-flask"></i> Tutorials</a></li>
            </ul>
        </div>
    </div>
</div>

<div class="container">

    <div class="row row-offcanvas row-offcanvas-right">

        <div class="col-xs-12 col-sm-9">

            <div class="row">

                <h1 id="helloWorldTutorial">Hello World Tutorial</h1>

                <p>This tutorial shows how to use Easy Rules on a very simple application.
                    The program should ask the user if he is a friend of duke and says 'Hello duke's friend!' only if he responds 'yes'.</p>

                <p>Based on this requirement, the rule is pretty straightforward :</p>
                <ul>
                    <li>The condition is that the user input must be 'yes'</li>
                    <li>The action is to say 'Hello duke's friend!' to the user</li>
                </ul>

                <p>First, let's create a new rule by extending the <code>BasicRule</code> class :</p>

<pre><code class="java">public class HelloWorldRule extends BasicRule {

    /**
    * The user input.
    */
    private String input;

    public HelloWorldRule(String name, String description, int priority) {
        super(name, description, priority);
    }

    @Override
    public boolean evaluateConditions() {
        //The rule should be applied only if the user's response is yes (duke friend)
        return input.equalsIgnoreCase("yes");
    }

    @Override
    public void performActions() throws Exception {
        //When rule conditions are satisfied, prints 'Hello duke's friend!' to the console
        System.out.println("Hello duke's friend!");
    }

    public void setInput(String input) {
        this.input = input;
    }

}
</code></pre>

                <p>Then, we have to register an instance of this rule to an Easy Rules engine and launch the program with the following class :</p>

<pre><code class="java">public class HelloWorldSampleLauncher {

    public static void main(String[] args) {

    Scanner scanner = new Scanner(System.in);
    System.out.println("Are you a friend of duke? [yes/no]:");
    String input = scanner.nextLine();

    /**
    * Define the rule
    */
    HelloWorldRule helloWorldRule =
            new HelloWorldRule("Hello World rule", "Say Hello to only duke's friends", 1);

    /**
    * Set data to operate on
    */
    helloWorldRule.setInput(input.trim());

    /**
    * Create a default rules engine and register the business rule
    */
    RulesEngine rulesEngine = new DefaultRulesEngine();
    rulesEngine.registerRule(helloWorldRule);

    /**
    * Fire rules
    */
    rulesEngine.fireRules();

    }

}
</code></pre>

                <p>To run this tutorial, you can follow these instructions from the root directory of Easy Rules :</p>
                <ul>
                    <li><code>$&gt;mvn install</code></li>
                    <li><code>$&gt;cd easyrules-samples</code></li>
                    <li><code>$&gt;mvn exec:java -P runHelloWorldTutorial</code></li>
                </ul>
				
				<p>If you run this tutorial, you would get the following output :</p>
				
<pre><code>Are you a friend of duke? [yes/no]:
yes
10 dec. 2013 13:26:19 io.github.benas.easyrules.core.DefaultRulesEngine fireRules
INFO: Rule 'Hello World rule' triggered.
Hello duke's friend!
10 dec. 2013 13:26:19 io.github.benas.easyrules.core.DefaultRulesEngine fireRules
INFO: Rule 'Hello World rule' performed successfully.
</code></pre>				

            </div>

            <div class="row">

                <h1 id="onlineShopTutorial">Online Shop Tutorial</h1>

                <p>In this tutorial, we have an online shop application and we would like to implement the following requirements :</p>
				<ol>
					<li>Whenever a new customer places an order with an amount greater than a defined threshold, send an alert about this suspect order to the monitoring team.</li>
					<li>Moreover, the order amount threshold should be reconfigurable via JMX so we can change it at runtime.</li>
				</ol>
				
                <p>In the first part of this tutorial, we will see how to use Easy Rules to implement the business rule described in requirement #1.</p>
				<p>In the second part, we will add JMX capability to the business rule developed in part 1 to be able to change the order amount threshold at runtime (requirement #2).</p>

				<h3>Part 1 : Implementing the business rule</h3>
				
                <p>In this application, orders and customers are represented by the 
				<a href="https://github.com/benas/easy-rules/blob/master/easyrules-samples/src/main/java/io/github/benas/easyrules/samples/order/Order.java"><code>Order</code></a> and
				<a href="https://github.com/benas/easy-rules/blob/master/easyrules-samples/src/main/java/io/github/benas/easyrules/samples/order/Customer.java"><code>Customer</code></a> classes.</p>

                <p>First, let's implement the rule's logic by extending the <code>BasicRule</code> class as follows :</p>

<pre><code class="java">public class SuspectOrderRule extends BasicRule {

    private float suspectOrderAmountThreshold = 1000;

    private Order order;

    private Customer customer;

    SuspectOrderRule(String name, String description, int priority) {
        super(name, description, priority);
    }

    @Override
    public boolean evaluateConditions() {
        return order.getAmount() > suspectOrderAmountThreshold && customer.isNew();
    }

    @Override
    public void performActions() throws Exception {
        System.out.println("Alert : A new customer [id=" + customer.getCustomerId() +
        "] has placed an order [id=" + order.getOrderId() + "] with amount " +
        order.getAmount() + " > " + suspectOrderAmountThreshold);
    }

    // getters and setters for customer and order fields omitted

}
</code></pre>

                <p>This rule operates on an order and a customer instances which represent the data needed to operate on.</p>

                <p>The <code>evaluateConditions</code> method evaluates to true when the customer is new and the order amount is greater than the defined threshold.</p>

                <p>The <code>performActions</code> method simply writes to the console the specified alert (this could be sending an email or another action in a real use case). </p>

                <p>Then, let's create an Easy Rules engine and register the <code>SuspectOrderRule</code> rule :</p>

<pre><code class="java">public class OrderSampleLauncher {

    public static void main(String[] args) throws InterruptedException {

    Order order = new Order(6654, 1200);
    Customer customer = new Customer(2356, true);

    /**
    * Create a business rule instance
    */
    SuspectOrderRule suspectOrderRule = new SuspectOrderRule(
		"Suspect Order",
		"Send alert if a new customer places an order with amount greater than a threshold",
		1);

    /**
    * Set data to operate on
    */
    suspectOrderRule.setOrder(order);
    suspectOrderRule.setCustomer(customer);

    /**
    * Create a default rules engine and register the business rule
    */
    RulesEngine rulesEngine = new DefaultRulesEngine();
    rulesEngine.registerRule(suspectOrderRule);

    /**
    * Fire rules
    */
    rulesEngine.fireRules();

    }
}
</code></pre>

                <p>To run this tutorial, you can follow these instructions from the root directory of Easy Rules :</p>
                <ul>
                    <li><code>$&gt;mvn install</code></li>
                    <li><code>$&gt;cd easyrules-samples</code></li>
                    <li><code>$&gt;mvn exec:java -P runOnlineShopTutorial</code></li>
                </ul>

                <p>When you run this tutorial, the rule named <code>Suspect Order</code> that we registered will be applied
                    since the order amount (1200) is greater than the threshold (1000) and the customer 2356 is a new customer. </p>
				
				<h3>Part 2 : Adding JMX capability to the business rule</h3>
				
				<p>With Easy Rules, you can extend the <code>BasicJmxManagedRule</code> to make your rule manageable via JMX. By default, only the rule priority will be exposed as a JMX attribute.</p>
				
				<p>In this tutorial, we need also to expose the order amount threshold as a JMX attribute. So first, let's define an interface that allows us to change order amount threshold via JMX as follows :</p>

<pre><code class="java">@MXBean
public interface SuspectOrderJmxManagedRule extends JmxManagedRule {

    /**
    * Get the current suspect order amount threshold
    * @return current suspect order amount threshold
    */
    float getSuspectOrderAmountThreshold();

    /**
    * Set the suspect order amount threshold
    * @param suspectOrderAmountThreshold the new suspect order amount threshold
    */
    void setSuspectOrderAmountThreshold(float suspectOrderAmountThreshold);

}
</code></pre>

			<p>Then, we should make our <code>SuspectOrderRule</code> extend the <code>BasicJmxManagedRule</code> to inherit JMX capabilities and implement the <code>SuspectOrderJmxManagedRule</code> to expose the order amount threshold as JMX attribute.</p>
			<p>So here is the new <code>SuspectOrderRule</code> class :</p>
				
<pre><code class="java">public class SuspectOrderRule extends BasicJmxManagedRule implements SuspectOrderJmxManagedRule {

    private float suspectOrderAmountThreshold = 1000;

    private Order order;

    private Customer customer;

    SuspectOrderRule(String name, String description, int priority) {
        super(name, description, priority);
    }

    @Override
    public boolean evaluateConditions() {
        return order.getAmount() > suspectOrderAmountThreshold && customer.isNew();
    }

    @Override
    public void performActions() throws Exception {
        System.out.println("Alert : A new customer [id=" + customer.getCustomerId() +
        "] has placed an order [id=" + order.getOrderId() + "] with amount " +
        order.getAmount() + " > " + suspectOrderAmountThreshold);
    }

    // getters and setters for customer, order omitted

    public float getSuspectOrderAmountThreshold() {
        return suspectOrderAmountThreshold;
    }

    public void setSuspectOrderAmountThreshold(float suspectOrderAmountThreshold) {
        this.suspectOrderAmountThreshold = suspectOrderAmountThreshold;
    }

}
</code></pre>

			<p>Finally, let's suspend the program for 30s to change the order amount threshold value at runtime 
			via any compliant JMX client and see the engine behavior after this change :</p>
			
<pre><code class="java">public class OrderSampleLauncher {

    public static void main(String[] args) throws InterruptedException {

    Order order = new Order(6654, 1200);
    Customer customer = new Customer(2356, true);

    /**
    * Create a business rule instance
    */
    SuspectOrderRule suspectOrderRule = new SuspectOrderRule(
		"Suspect Order",
		"Send alert if a new customer places an order with amount greater than a threshold",
		1);

    /**
    * Set data to operate on
    */
    suspectOrderRule.setOrder(order);
    suspectOrderRule.setCustomer(customer);

    /**
    * Create a default rules engine and register the business rule
    */
    RulesEngine rulesEngine = new DefaultRulesEngine();
    rulesEngine.registerJmxManagedRule(suspectOrderRule);

    /**
    * Fire rules
    */
    rulesEngine.fireRules();

    // Suspend execution for 30s to have time to update suspect order amount threshold via a JMX client.
    Thread.sleep(30000);

    System.out.println("**************************************************************");
    System.out.println("Re fire rules after updating suspect order amount threshold...");
    System.out.println("**************************************************************");

    rulesEngine.fireRules();

    }
}
</code></pre>

                <p>In the next screenshot, we use <a href="http://visualvm.java.net/">VisualVM</a> to change the threshold value :</p>

                <p>
                    <img src="img/jmx-suspectOrderRule.png"/>
                </p>

                <p>If you change the threshold value to 1400 for example within the 30s of program pause, you will see that the rule <code>Suspect Order</code>
                will not be applied the second time since the order amount (1200) is no longer greater than the new threshold (1400).</p>
				
            </div>

        </div>

        <div class="col-xs-6 col-sm-3 sidebar-offcanvas" id="sidebar" role="navigation">
            <div class="list-group">
                <a href="index.html" class="list-group-item"><i class="fa fa-home"></i> Home</a>
                <a href="gettingStarted.html" class="list-group-item"><i class="fa fa-folder-open"></i> Getting started</a>
                <a href="documentation.html" class="list-group-item"><i class="fa fa-book"></i> Documentation</a>
                <a href="tutorials.html" class="list-group-item active"><i class="fa fa-flask"></i> Tutorials</a>
            </div>
        </div>

    </div>

    <hr>

    <footer>
        <div class="container">
            <p class="pull-right"><a href="#"><i class="fa fa-arrow-up"></i> Back to top</a></p>

            <p>Easy Rules is maintained by <a href="mailto:md.benhassine@gmail.com?subject=[Easy Rules]"><i
                    class="fa fa-envelope"></i> benas</a> at <a href="https://github.com/benas/easy-rules"><i
                    class="fa fa-github-alt"></i> Github</a></p>
        </div>
    </footer>

</div>
<script src="js/jquery-1.10.2.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/offcanvas.js"></script>
<script src="js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</body>
</html>

